<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Automating haveibeenpwned Breach Searches with Powershell" /><meta property="og:locale" content="en" /><meta name="description" content="Introduction In an effort to automate as much as possible for my organization, I created two Powershell modules to help out our team with various tasks. This use case is the automation of checking haveibeenpwned (HIBP) daily and confirming if any of our enterprise users were found in a breach. The daemon scripts also creates a Trello card with breach info and affected users." /><meta property="og:description" content="Introduction In an effort to automate as much as possible for my organization, I created two Powershell modules to help out our team with various tasks. This use case is the automation of checking haveibeenpwned (HIBP) daily and confirming if any of our enterprise users were found in a breach. The daemon scripts also creates a Trello card with breach info and affected users." /><link rel="canonical" href="https://opfor-haunter.github.io/posts/haveibeenpwned-Trello-Powershell-Automation/" /><meta property="og:url" content="https://opfor-haunter.github.io/posts/haveibeenpwned-Trello-Powershell-Automation/" /><meta property="og:site_name" content="./OpposingForce" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-06-20T00:00:00-07:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Automating haveibeenpwned Breach Searches with Powershell" /><meta name="twitter:site" content="@OPFOR-HAUNTER" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-06-21T14:50:22-07:00","datePublished":"2022-06-20T00:00:00-07:00","description":"Introduction In an effort to automate as much as possible for my organization, I created two Powershell modules to help out our team with various tasks. This use case is the automation of checking haveibeenpwned (HIBP) daily and confirming if any of our enterprise users were found in a breach. The daemon scripts also creates a Trello card with breach info and affected users.","headline":"Automating haveibeenpwned Breach Searches with Powershell","mainEntityOfPage":{"@type":"WebPage","@id":"https://opfor-haunter.github.io/posts/haveibeenpwned-Trello-Powershell-Automation/"},"url":"https://opfor-haunter.github.io/posts/haveibeenpwned-Trello-Powershell-Automation/"}</script><title>Automating haveibeenpwned Breach Searches with Powershell | ./OpposingForce</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="./OpposingForce"><meta name="application-name" content="./OpposingForce"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/profile.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">./OpposingForce</a></div><div class="site-subtitle font-italic">HAUNTER's SecOps stuff</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/ctfs/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>CTF WRITEUPS</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/OPFOR-HAUNTER" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/OPFOR-HAUNTER" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['gualberto.s.maciel','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Automating haveibeenpwned Breach Searches with Powershell</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Automating haveibeenpwned Breach Searches with Powershell</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> HAUNTER </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Mon, Jun 20, 2022, 12:00 AM -0700" >Jun 20<i class="unloaded">2022-06-20T00:00:00-07:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Tue, Jun 21, 2022, 5:50 PM -0400" >Jun 21<i class="unloaded">2022-06-21T14:50:22-07:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="659 words">3 min read</span></div></div><div class="post-content"><h2 id="introduction">Introduction</h2><p>In an effort to automate as much as possible for my organization, I created two Powershell modules to help out our team with various tasks. This use case is the automation of checking <a href="https://haveibeenpwned.com">haveibeenpwned (HIBP)</a> daily and confirming if any of our enterprise users were found in a breach. The daemon scripts also creates a Trello card with breach info and affected users.</p><h3 id="tldr">tl;dr</h3><details> <summary>Spoiler!</summary> 1. Enterprise users sometimes register with 3rd parties with their work email. With the possibility of the reuse of passwords with their 3rd party accounts, we track users found in breaches on haveibeenpwned.<br /> 2. HIBP Powershell module contains functions for automated haveibeenpwned processes for an enterprise.<br /> 3. Trello Powershell module contains functions for getting Trello infos and creating. Our org ingests alerts from various tools to Trello for uniform visibility and efficiency.<br /> 4. The HIBP Daily Breach Trello Daemon is a Powershell script usecase utilizing both modules.<br /> 5. More advanced automations can be done with the HIBP module. E.g., emailing users, summary reports, disabling user accounts (not included in this repo).<br /> 6. I am NOT a Powershell guru...and the code reflects this :S </details><h2 id="required-resources">Required Resources</h2><ul><li><a href="https://github.com/OPFOR-HAUNTER/SecOps/blob/main/BlueOps/Detection/HIBP/HIBP.psm1">haveibeenpwned API Powershell Module</a><li><a href="https://github.com/OPFOR-HAUNTER/SecOps/blob/main/NullOps/Automation/Trello.psm1">Trello API Powershell Module</a><li><a href="https://github.com/OPFOR-HAUNTER/SecOps/blob/main/BlueOps/Detection/HIBP/HIBP_Daily_Breach_Trello_Daemon_Example.ps1">HIBP Daily Breach Trello Daemon</a><li><a href="https://haveibeenpwned.com/API/v3">HIBP API (v3)</a> - API Key Required @ $3.50/month</ul><h2 id="the-problems">The Problem(s)</h2><h3 id="cumbersome-reactive-manual-process">Cumbersome, Reactive, Manual Process</h3><p>Lack of visibility and a unified threat alert platform for a multitude of security tools can lead to gaps in response time and monitoring efficiency. Currently, HIBP notifies organization via an email. Depending on many factors, this can delay the response to investigating the breach for affected users.</p><figure><img data-proofer-ignore data-src="/assets/img/BlueOps/Detection/HIBP/HIBP_Notification_email.PNG" /><figcaption>An example HIBP notification email.</figcaption></figure><p>At the time of authoring these scripts, the HIBP API did not have the capability of pulling an enterprise-wide call of all users found in a given breach. Instead, a SOC member would have to manually visit HIBP, enter our organization email, wait for the resulting CSV, filter the returned list by the most recent breach, and then finally verify each user. This verification part was partically cumbersome for larger breaches that may contain dozens or even hundreds of our users.</p><figure><img data-proofer-ignore data-src="/assets/img/BlueOps/Detection/HIBP/HIBP_Notification_email2.PNG" /><figcaption>Note that visiting the HIBP website is required to determine which accounts were expired.</figcaption></figure><p>HIBP reports all email addresses for a given enterprise in ALL existing breaches. This requires SOC staff to manually filter a CSV for the most recent breach that was reported. Additionally, as some of these breaches may have occurred years ago many users reported could be disabled, resulting in inefficient processing time.</p><figure><img data-proofer-ignore data-src="/assets/img/BlueOps/Detection/HIBP/HIBP_CSV_Example.PNG" /><figcaption>An example CSV that is returned from a GUI domain search. ALL breaches are returned for every user in your domain.</figcaption></figure><h2 id="the-solution">The Solution</h2><p>I created an automated daemon that runs daily. This allows us to proactively search for a breach posted on HIBP, parse enabled users against the breach and verify those affected, and then create a Trello card with info.</p><figure><img data-proofer-ignore data-src="/assets/img/BlueOps/Detection/HIBP/Trello_Cards.PNG" /><figcaption>Populated Trello cards. Note that the last card had a second label (blue) applied due to a high-risk factor we defined for breaches (below).</figcaption></figure><p>There are three attributes to a breach that our SOC checks for high risk factors that require an escalated response:<br /> * BreachDate - the date it was published on the darkweb. <br /> * AddedDate - the date the breach was posted on haveibeenpwned.com.<br /> * DataClasses - These are the types of data the breach contained. E.g., Email addresses, Credit card info, &amp; passwords. We classify breaches with Passwords as high risk.</p><figure><img data-proofer-ignore data-src="/assets/img/BlueOps/Detection/HIBP/Trello_Card.PNG" /><figcaption>A generated card. Breach data, label, affected users are populated. User's SamAccountNames and PasswordLastSet are included in the details.</figcaption></figure><h2 id="final-thoughts">Final Thoughts</h2><p>These scripts are written terribly and can be refactored by someone more talented. The time saved is a plus, and it was a great learning experience. Before our on-prem SMTP server was decommissioned there was an additional function to email affected users, and optionally disable accounts based on additional risk factors found in the breach. Maybe one day I’ll get back to adding them…</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/blueops/'>BlueOps</a>, <a href='/categories/detection/'>Detection</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/blueops/" class="post-tag no-text-decoration" >BlueOps</a> <a href="/tags/detection/" class="post-tag no-text-decoration" >detection</a> <a href="/tags/automation/" class="post-tag no-text-decoration" >automation</a> <a href="/tags/powershell/" class="post-tag no-text-decoration" >powershell</a> <a href="/tags/haveibeenpwned/" class="post-tag no-text-decoration" >haveibeenpwned</a> <a href="/tags/trello/" class="post-tag no-text-decoration" >trello</a> <a href="/tags/daemon/" class="post-tag no-text-decoration" >daemon</a> <a href="/tags/api/" class="post-tag no-text-decoration" >api</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Automating haveibeenpwned Breach Searches with Powershell - ./OpposingForce&url=https://opfor-haunter.github.io/posts/haveibeenpwned-Trello-Powershell-Automation/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Automating haveibeenpwned Breach Searches with Powershell - ./OpposingForce&u=https://opfor-haunter.github.io/posts/haveibeenpwned-Trello-Powershell-Automation/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Automating haveibeenpwned Breach Searches with Powershell - ./OpposingForce&url=https://opfor-haunter.github.io/posts/haveibeenpwned-Trello-Powershell-Automation/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink('', 'Link copied successfully!')" data-toggle="tooltip" data-placement="top" title="Copy link"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/haveibeenpwned-Trello-Powershell-Automation/">Automating haveibeenpwned Breach Searches with Powershell</a><li><a href="/posts/HTB-SP-T1-Appointment/">HTB Starting Point - Tier 1 - Appointment</a><li><a href="/posts/HTB-SP-T0-Explosion/">HTB Starting Point - Tier 0 - Explosion</a><li><a href="/posts/HTB-SP-T0-Redeemer/">HTB Starting Point - Tier 0 - Redeemer</a><li><a href="/posts/HTB-SP-T1-Tactics/">HTB Starting Point - Tier 1 - Tactics</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/redops/">RedOps</a> <a class="post-tag" href="/tags/writeup/">writeup</a> <a class="post-tag" href="/tags/very-easy/">very_easy</a> <a class="post-tag" href="/tags/easy/">easy</a> <a class="post-tag" href="/tags/bruteforce/">bruteforce</a> <a class="post-tag" href="/tags/ftp/">ftp</a> <a class="post-tag" href="/tags/gobuster/">gobuster</a> <a class="post-tag" href="/tags/injection/">injection</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/HTB-SP-T0-Redeemer/"><div class="card-body"> <span class="timeago small" >May 16<i class="unloaded">2022-05-16T00:00:00-07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HTB Starting Point - Tier 0 - Redeemer</h3><div class="text-muted small"><p> Introduction Reedemer is a new host on the Starting Point Tier 0 level. Some light reading of Redis will be needed for this exercise. tl;dr ...</p></div></div></a></div><div class="card"> <a href="/posts/HTB-SP-T2-Markup/"><div class="card-body"> <span class="timeago small" >Mar 22<i class="unloaded">2022-03-22T00:00:00-07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HTB Starting Point - Tier 2 - Markup</h3><div class="text-muted small"><p> Introduction tl;dr Spoiler! ...</p></div></div></a></div><div class="card"> <a href="/posts/HTB-SP-T2-Included/"><div class="card-body"> <span class="timeago small" >Mar 22<i class="unloaded">2022-03-22T00:00:00-07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HTB Starting Point - Tier 2 - Included</h3><div class="text-muted small"><p> Introduction tl;dr Spoiler! ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/HTB-SP-T0-Redeemer/" class="btn btn-outline-primary" prompt="Older"><p>HTB Starting Point - Tier 0 - Redeemer</p></a> <span class="btn btn-outline-primary disabled" prompt="Newer"><p>-</p></span></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/OPFOR-HAUNTER">HAUNTER</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/redops/">RedOps</a> <a class="post-tag" href="/tags/writeup/">writeup</a> <a class="post-tag" href="/tags/very-easy/">very_easy</a> <a class="post-tag" href="/tags/easy/">easy</a> <a class="post-tag" href="/tags/bruteforce/">bruteforce</a> <a class="post-tag" href="/tags/ftp/">ftp</a> <a class="post-tag" href="/tags/gobuster/">gobuster</a> <a class="post-tag" href="/tags/injection/">injection</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://OPFOR-HAUNTER.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
